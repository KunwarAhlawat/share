<%- include('../../partials/header.ejs', { title: title }) %>

<div class="page-content">
  <!-- Main sidebar -->
  <%- include('../../partials/sidebar.ejs') %>
  <!-- /main sidebar -->

  <!-- Main content -->
  <div class="content-wrapper">
    <!-- Main navbar -->
	<%- include('../../component/dashboard/navbar.ejs') %>
    <!-- /main navbar -->

    <!-- Inner content -->
    <div class="content-inner">
    

      <!-- Content area -->
      <div class="content">
        <!-- Nested object data -->
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">All Firms </h5>
                <!-- <button class="btn btn-light">Add Customer</button> -->
                <!-- Button to trigger modal -->
                <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#add-firm-model">Add Firm<i class="ph ph-user ms-2"></i></button>
            </div>
           
            
          </div>

       
          <!-- Hidden element to pass JSON data to the JavaScript file -->
          <script type="application/json" id="data"> <%- JSON.stringify({ data: data, label: "firms", }) %> </script>
        
          
          
          
        
            <table class="table datatable-nested ">
              <thead>
                <tr>
                  <th>Firm</th>
                  <th>Address</th>
				  <th>Pincode</th>
                  <th>GST Number</th>
                  <th>Account Number</th>
				  <th>Bank Name</th>
                  <th>IFSC Code</th>
                  <th>Product Produced</th>
				  <th>Action</th>
                </tr>
              </thead>
			  <tbody>
				<!-- Data will be dynamically injected here -->
			  </tbody>
            </table>
        
        </div>
        <!-- /nested object data -->

        
      </div>
      <!-- /content area -->
    </div>
    <!-- /inner content -->
  </div>
  <!-- /main content -->
</div>
<!-- /page content -->



<!-- add firm model -->
<div id="add-firm-model" class="modal fade" tabindex="-1" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-full"></div>
  <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Edit Firm</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
          <form action="/dashboard/firm/create" method="POST" enctype="">
              <!-- Firm Information -->
              <div class="form-section mb-4">
                  <h4 class="mb-3">Area Information</h4>
                  <div class="row">
                         <!-- firm Name -->
                         <div class="col-md-6">
                          <div class="mb-3">
                              <label for="firm_name" class="form-label">Firm*</label>
                              <input type="text" id="firm_name" class="form-control"  name="firm_name" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the firm name as per official documents.</small>
                              
                          </div>
                      </div>
                      
                        <!-- GST Number-->
                        <div class="col-md-6">
                          <div class="mb-3">
                              <label for="gst_number" class="form-label">GST Number</label>
                              <input type="text" class="form-control" id="gst_number" name="gst_number" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the GST Number of firm as per official documents.</small>
                          </div>
                        </div>
                       
                        
                    
                     
                  </div>
          
                  <div class="row">
  <!-- address -->
  <div class="col-md-6">
    <div class="mb-3">
        <label for="firm_address" class="form-label">Address*</label>
        <input type="text" class="form-control" id="firm_address" name="firm_address" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
        <small class="form-text text-muted">Enter the Firm Address as per official documents.</small>
        
    </div>
</div>

  <!-- pincode -->
  <div class="col-md-6">
    <div class="mb-3">
        <label for="firm_pincode" class="form-label">PinCode*</label>
        <input type="text" class="form-control" id="firm_pincode" name="firm_pincode" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
        <small class="form-text text-muted">Enter the Firm PinCode as per official documents.</small>
        
    </div>
</div>
                  </div>
                  <div class="row">
                      <!-- product produced -->
                      <div class="col-md-6">
                        <div class="mb-3">
                            <label for="product_produced" class="form-label">Product Produced</label>
                            <input type="text" class="form-control" id="product_produced" name="product_produced" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                            <small class="form-text text-muted">Enter the  Product Produced by firm as per official documents.</small>
                        </div>
                      </div>
                        
                      <!-- product quantity-->
                      <div class="col-md-6">
                        <div class="mb-3">
                            <label for="product_quantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="product_quantity" name="product_quantity" minlength="1" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                            <small class="form-text text-muted">Enter the Quantity Number of firm as per official documents.</small>
                        </div>
                      </div>
                     
                      
                  </div>
          

                  <div class="row">
                    <!-- account number -->
                    <div class="col-md-4">
                      <div class="mb-3">
                          <label for="account_number" class="form-label">Account Number</label>
                          <input type="text" class="form-control" id="account_number" name="account_number" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                          <small class="form-text text-muted">Enter the Account Number of firm as per official documents.</small>
                      </div>
                    </div>
                      
                    <!-- Bank Name-->
                    <div class="col-md-4">
                      <div class="mb-3">
                          <label for="bank_name" class="form-label">Bank Name`</label>
                          <input type="text" class="form-control" id="bank_name" name="bank_name" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                          <small class="form-text text-muted">Enter the Bank Name of firm as per official documents.</small>
                      </div>
                    </div>

                     <!-- IFSC code-->
                     <div class="col-md-4">
                      <div class="mb-3">
                          <label for="ifsc_code" class="form-label">IFSC Code</label>
                          <input type="text" class="form-control" id="ifsc_code" name="ifsc_code" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                          <small class="form-text text-muted">Enter the IFSC Code of firm as per official documents.</small>
                      </div>
                    </div>
                   
                    
                </div>
    
              </div>
          
              <div class="modal-footer">
                  <button type="button" class="btn btn-link" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save</button>
              </div>
          </form>
          
          
  </div>
  </div>
</div>

<!-- edit firm model -->
<div id="edit-firm-model" class="modal fade" tabindex="-1" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-full"></div>
  <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Edit Firm</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
          <form action="/dashboard/firm/create" method="POST" enctype="">
              <!-- Firm Information -->
              <div class="form-section mb-4">
                  <h4 class="mb-3">Area Information</h4>
                  <div class="row">
                         <!-- firm Name -->
                         <div class="col-md-6">
                          <div class="mb-3">
                              <label for="firm_name" class="form-label">Firm*</label>
                              <input type="text" id="firm_name" class="form-control"  name="firm_name" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the firm name as per official documents.</small>
                              
                          </div>
                      </div>
                      
                        <!-- GST Number-->
                        <div class="col-md-6">
                          <div class="mb-3">
                              <label for="gst_number" class="form-label">GST Number</label>
                              <input type="text" class="form-control" id="gst_number" name="gst_number" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the GST Number of firm as per official documents.</small>
                          </div>
                        </div>
                       
                        
                    
                     
                  </div>
          
                  <div class="row">
  <!-- address -->
  <div class="col-md-6">
    <div class="mb-3">
        <label for="firm_address" class="form-label">Address*</label>
        <input type="text" class="form-control" id="firm_address" name="firm_address" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
        <small class="form-text text-muted">Enter the Firm Address as per official documents.</small>
        
    </div>
</div>

  <!-- pincode -->
  <div class="col-md-6">
    <div class="mb-3">
        <label for="firm_pincode" class="form-label">PinCode*</label>
        <input type="text" class="form-control" id="firm_pincode" name="firm_pincode" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
        <small class="form-text text-muted">Enter the Firm PinCode as per official documents.</small>
        
    </div>
</div>
                  </div>
                  <div class="row">
                      <!-- product produced -->
                      <div class="col-md-6">
                        <div class="mb-3">
                            <label for="product_produced" class="form-label">Product Produced</label>
                            <input type="text" class="form-control" id="product_produced" name="product_produced" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                            <small class="form-text text-muted">Enter the  Product Produced by firm as per official documents.</small>
                        </div>
                      </div>
                        
                      <!-- product quantity-->
                      <div class="col-md-6">
                        <div class="mb-3">
                            <label for="product_quantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="product_quantity" name="product_quantity" minlength="1" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                            <small class="form-text text-muted">Enter the Quantity Number of firm as per official documents.</small>
                        </div>
                      </div>
                     
                      
                  </div>
          

                  <div class="row">
                    <!-- account number -->
                    <div class="col-md-4">
                      <div class="mb-3">
                          <label for="account_number" class="form-label">Account Number</label>
                          <input type="text" class="form-control" id="account_number" name="account_number" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                          <small class="form-text text-muted">Enter the Account Number of firm as per official documents.</small>
                      </div>
                    </div>
                      
                    <!-- Bank Name-->
                    <div class="col-md-4">
                      <div class="mb-3">
                          <label for="bank_name" class="form-label">Bank Name`</label>
                          <input type="text" class="form-control" id="bank_name" name="bank_name" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                          <small class="form-text text-muted">Enter the Bank Name of firm as per official documents.</small>
                      </div>
                    </div>

                     <!-- IFSC code-->
                     <div class="col-md-4">
                      <div class="mb-3">
                          <label for="ifsc_code" class="form-label">IFSC Code</label>
                          <input type="text" class="form-control" id="ifsc_code" name="ifsc_code" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                          <small class="form-text text-muted">Enter the IFSC Code of firm as per official documents.</small>
                      </div>
                    </div>
                   
                    
                </div>
    
              </div>
          
              <div class="modal-footer">
                  <button type="button" class="btn btn-link" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save</button>
              </div>
          </form>
          
          
  </div>
  </div>
</div>

<!-- confirm delete model -->
<div class="modal fade" id="confirm" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this item?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>
<script>

  let deletedFirmID = null;
 
   function setEditFirmData(firmId) {
 
     // debug
     console.log("firmId-setEditFirmData-f", typeof firmId)
     try {
       // Retrieve and parse data
       const rawData = $("#data").text().trim();
       let parsedData = JSON.parse(rawData);
       const { data } = parsedData;
 
       // Find the firm by areaId
       const firm = data.find(item => item.firmId === firmId);
 
       if (!firm) {
         console.error(`Employee with ID ${firmId} not found`);
         return;
       }
 
       console.log("Show data with ID:",firmId, firm);
      
 
       // Create modal and form references
       const modal = new bootstrap.Modal(document.getElementById('edit-firm-model'));
       const form = document.querySelector('#edit-firm-model form');
 
       // Set form action URL
       const actionUrl = `/dashboard/firm/update/edit/${firmId}`;
       form.action = actionUrl;
 
 
       // Populate form fields
       form.querySelector('#firm_name').value = firm.firmName || '';
       form.querySelector('#firm_address').value = firm.address || '';
       form.querySelector('#firm_pincode').value = firm.pincode || '';
       form.querySelector('#gst_number').value = firm.GSTNumber || '';
       form.querySelector('#account_number').value = firm.accountNumber || '';
       form.querySelector('#bank_name').value = firm.bankName || '';
       form.querySelector('#ifsc_code').value = firm.IFSCcode || '';
       form.querySelector('#product_produced').value = firm.ProductProduced || '';
       form.querySelector('#product_quantity').value = firm.Quantity || '';
    
       
       // Handle photo preview (if applicable)
       // Uncomment if you have a way to show the existing photo
       // const photoPreview = document.querySelector('#photo-preview');
       // if (employee.photo) {
       //     photoPreview.src = employee.photo; // Set this to the URL of the photo
       // } else {
       //     photoPreview.src = ''; // Hide or clear the preview
       // }
 
       // Show the modal
       modal.show();
 
     } catch (error) {
       console.error("Error handling edit data:", error);
     }
   }
 
   // Function to handle delete data
   function setDeleteFirmData(firmId) {
    deletedFirmID=firmId;
     try {
       // Retrieve and parse data
       const rawData = $("#data").text().trim();
       let parsedData = JSON.parse(rawData);
       const { data } = parsedData;
 
       // Find the firm by firmId
       const firm = data.find(item => item.firmId === firmId);
 
       if (!firm) {
         console.error(`Firm with ID ${firmId} not found`);
         return;
       }
 
       console.log("Show data with ID:", firmId, firm);
     
 
       // Create modal and form references
       const modal = new bootstrap.Modal(document.getElementById('confirm'));
       // const form = document.querySelector('#edit-employee-model form');
 
       // // Set form action URL
       // const actionUrl = `/dashboard/employees/edit/${empId}`;
       // form.action = actionUrl;
 
 
 
       // Show the modal
       modal.show();
 
     } catch (error) {
       console.error("Error handling delete data:", error);
     }
   };
   
   async function confirmDelete() {
 // Check if the deletedFirmID is valid
 if (deletedFirmID !== null && deletedFirmID !== undefined) {
   try {
     const response = await fetch(`/dashboard/firm/delete/${deletedFirmID}`, {
       method: 'DELETE',
     });
 
     // Close the Bootstrap modal before alerting or refreshing the page
     const modalElement = document.getElementById('confirm');
     const modalInstance = bootstrap.Modal.getInstance(modalElement);
     modalInstance.hide();
 
     // const data = await response.json();
 
     if (response.ok) {
       alert('Record deleted successfully!');
       location.reload(); // Optionally, refresh the page to reflect changes
     } else {
       alert('Error deleting record.');
     }
   } catch (error) {
     console.error('Error:', error);
   }
 } else {
   console.error('No area ID provided for deletion.');
 }
 }
 
 </script>
 <%- include('../../partials/footer') %>

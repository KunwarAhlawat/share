<%- include('../../partials/header.ejs', { title: title }) %>
  <style>
    .error-message {
      color: red;
      display: none;
    }
  </style>

  <div class="page-content">
    <!-- Main sidebar -->
    <%- include('../../partials/sidebar.ejs') %>
      <!-- /main sidebar -->

      <!-- Main content -->
      <div class="content-wrapper">
        <!-- Main navbar -->
        <%- include('../../component/dashboard/navbar.ejs') %>
          <!-- /main navbar -->

          <!-- Inner content -->
          <div class="content-inner">
            <!-- Content employee -->
            <div class="content">
              <!-- Nested object data -->
              <div class="card">
                <div class="card-header">
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">All Employee</h5>
                    <!-- <button class="btn btn-light">Add Customer</button> -->

                    <!-- Button to trigger add employees modal -->
                    <button type="button" class="btn btn-light" data-bs-toggle="modal"
                      data-bs-target="#add-employee-model">
                      Add Employee<i class="ph ph-user ms-2"></i>
                    </button>
                  </div>
                </div>

            

                <table class="table datatable-nested">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Designation</th>
                      <th>Phone</th>
                      <th>Email</th>
                      <th>Gender</th>
                      <th>DOB</th>
                      <th>Blood Group</th>
                      <th>Address</th>
                      <th>Father</th>
                      <th>Mother</th>
                      <th>Bank</th>
                      <th>Bank Account</th>
                      <th>IFSC Code</th>
                      <th>Aadhaar</th>
                      <th>Pan</th>
                      <th>Joining Date</th>
                      <th>Leaving Date</th>
                      <th>Refer By</th>
                      <th>Reference Phone</th>
                      <th>Role</th>
                      <th>Password</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Data will be dynamically injected here -->
                  </tbody>
                </table>
              </div>
              <!-- /nested object data -->
            </div>
            <!-- /content employee -->
          </div>
          <!-- /inner content -->
      </div>
      <!-- /main content -->
  </div>
  <!-- /page content -->



  <!--  Employee Modal -->
  <div id="add-employee-model" class="modal fade" tabindex="-1" aria-labelledby="EmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-full">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="EmployeeModalLabel"> Employee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="" method="POST" enctype="multipart/form-data" class="needs-validation" id="add-employee-form">
            <div class="form-section mb-4">
              <h4 class="mb-3">Employee Information</h4>
              <div class="row">
                <!-- Employee Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="employee_name" class="form-label">Employee Name*</label>
                    <input type="text" class="form-control" id="employee_name" name="employee_name" required>
                    <small class="form-text text-muted">Enter the full name as per official documents.</small>
                    <div class="invalid-feedback">Employee name cannot be empty and must contain only letters and
                      spaces.</div>
                  </div>
                </div>
                <!-- Date of Birth -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth*</label>
                    <input type="date" class="form-control" id="dob" name="dob" required>
                    <small class="form-text text-muted">Enter your date of birth.</small>
                    <div class="invalid-feedback">Date of birth must be a valid date.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Date of Joining -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="doj" class="form-label">Date of Joining*</label>
                    <input type="date" class="form-control" id="doj" name="doj" required>
                    <small class="form-text text-muted">Enter the date of joining.</small>
                    <div class="invalid-feedback">Date of joining must be a valid date.</div>
                  </div>
                </div>
                <!-- Designation -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="designation" class="form-label">Designation*</label>
                    <input type="text" class="form-control" id="designation" name="designation" required>
                    <small class="form-text text-muted">Enter the employee's current job title.</small>
                    <div class="invalid-feedback">Designation cannot be empty.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Gender -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="gender" class="form-label">Gender*</label>
                    <select class="form-control" id="gender" name="gender" required>
                      <option value="" disabled selected>Select your gender</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                    <small class="form-text text-muted">Specify the gender as per official records.</small>
                    <div class="invalid-feedback">Gender cannot be empty.</div>
                  </div>
                </div>
                <!-- Email -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="email" class="form-label">Email*</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                    <small class="form-text text-muted">Enter a valid email address for communication.</small>
                    <div class="invalid-feedback">Valid email is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Primary Mobile Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="primary_mobile" class="form-label">Primary Mobile Number*</label>
                    <input type="tel" class="form-control" id="primary_mobile" name="primary_mobile" required
                      pattern="^[0-9]{10}$">
                    <small class="form-text text-muted">Provide a 10-digit mobile number.</small>
                    <div class="invalid-feedback">Primary mobile number must be a 10-digit number.</div>
                  </div>
                </div>
                <!-- Aadhar Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="aadhar_number" class="form-label">Aadhar Number</label>
                    <input type="text" class="form-control" id="aadhar_number" name="aadhar_number"
                      pattern="^[0-9]{12}$">
                    <small class="form-text text-muted">Enter the 12-digit Aadhar number.</small>
                    <div class="invalid-feedback">Aadhar number must be exactly 12 digits.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- PAN Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="pan_number" class="form-label">PAN Number</label>
                    <input type="text" class="form-control" id="pan_number" name="pan_number"
                      pattern="^[A-Z]{5}[0-9]{4}[A-Z]{1}$">
                    <small class="form-text text-muted">Enter the PAN number in the format 'ABCDE1234F'.</small>
                    <div class="invalid-feedback">PAN number must be in the correct format.</div>
                  </div>
                </div>
                <!-- Address -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address" name="address">
                    <small class="form-text text-muted">Enter the current residential address.</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Bank Account Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="bank_account" class="form-label">Bank Account Number</label>
                    <input type="text" class="form-control" id="bank_account" name="bank_account" pattern="^[0-9]+$">
                    <small class="form-text text-muted">Bank account number where salary is cred.</small>
                    <div class="invalid-feedback">Bank account number must contain only numbers.</div>
                  </div>
                </div>
                <!-- Bank Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="bank_name" class="form-label">Bank Name</label>
                    <input type="text" class="form-control" id="bank_name" name="bank_name">
                    <small class="form-text text-muted">Name of the bank where the account is held.</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- IFSC Code -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="ifsc_code" class="form-label">IFSC Code</label>
                    <input type="text" class="form-control" id="ifsc_code" name="ifsc_code"
                      pattern="^[A-Z]{4}[0-9]{7}$">
                    <small class="form-text text-muted">IFSC code for electronic fund transfers.</small>
                    <div class="invalid-feedback">IFSC code must be alphanumeric.</div>
                  </div>
                </div>
                <!-- Date of Leaving -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="date_of_leaving" class="form-label">Date of Leaving</label>
                    <input type="date" class="form-control" id="date_of_leaving" name="date_of_leaving">
                    <small class="form-text text-muted">Date on which the employee leaves the company (if
                      applicable).</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Father's Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="father_name" class="form-label">Father's Name</label>
                    <input type="text" class="form-control" id="father_name" name="father_name">
                    <small class="form-text text-muted">Name of the employee's father.</small>
                  </div>
                </div>
                <!-- Mother's Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="mother_name" class="form-label">Mother's Name</label>
                    <input type="text" class="form-control" id="mother_name" name="mother_name">
                    <small class="form-text text-muted">Name of the employee's mother.</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Spouse Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="spouse_name" class="form-label">Spouse's Name</label>
                    <input type="text" class="form-control" id="spouse_name" name="spouse_name">
                    <small class="form-text text-muted">Name of the employee's spouse (if applicable).</small>
                  </div>
                </div>
                <!-- Spouse Mobile Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="spouse_mobile" class="form-label">Spouse's Mobile Number</label>
                    <input type="tel" class="form-control" id="spouse_mobile" name="spouse_mobile"
                      pattern="^[0-9]{10}$">
                    <small class="form-text text-muted">Provide a 10-digit mobile number for the spouse.</small>
                    <div class="invalid-feedback">Spouse's mobile number must be a 10-digit number.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Father Mobile Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="father_mobile" class="form-label">Father's Mobile Number</label>
                    <input type="tel" class="form-control" id="father_mobile" name="father_mobile"
                      pattern="^[0-9]{10}$">
                    <small class="form-text text-muted">Provide a 10-digit mobile number for the father.</small>
                    <div class="invalid-feedback">Father's mobile number must be a 10-digit number.</div>
                  </div>
                </div>
                <!-- Mother Mobile Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="mother_mobile" class="form-label">Mother's Mobile Number</label>
                    <input type="tel" class="form-control" id="mother_mobile" name="mother_mobile"
                      pattern="^[0-9]{10}$">
                    <small class="form-text text-muted">Provide a 10-digit mobile number for the mother.</small>
                    <div class="invalid-feedback">Mother's mobile number must be a 10-digit number.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Photo -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="photo" class="form-label">Photo</label>
                    <input type="file" class="form-control" id="photo" name="photo">
                    <small class="form-text text-muted">Upload a recent photo of the employee.</small>
                  </div>
                </div>
                <!-- Resume -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="resume" class="form-label">Resume</label>
                    <input type="file" class="form-control" id="resume" name="resume">
                    <small class="form-text text-muted">Upload the employee's resume.</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Reference -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="reference" class="form-label">Reference</label>
                    <input type="text" class="form-control" id="reference" name="reference">
                    <small class="form-text text-muted">Details of the person who referred the employee.</small>
                  </div>
                </div>
                <!-- Reference Contact Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="reference_contact" class="form-label">Reference Contact Number</label>
                    <input type="tel" class="form-control" id="reference_contact" name="reference_contact"
                      pattern="^[0-9]{10}$">
                    <small class="form-text text-muted">Provide a 10-digit contact number of the reference.</small>
                    <div class="invalid-feedback">Reference contact number must be a 10-digit number.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Role -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="role" class="form-label">Role*</label>
                    <select class="form-control" id="role" name="role" required>
                      <option value="" disabled selected>Select Role</option>
                      <option value="Admin">Admin</option>
                      <option value="User">User</option>
                      <option value="Moderator">Moderator</option>
                    </select>
                    <div class="invalid-feedback">Role cannot be empty.</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Password -->
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="password" class="form-label">Password*</label>
                  <input type="password" class="form-control" id="password" name="password" required>
                  <div class="invalid-feedback">Password cannot be empty.</div>
                </div>
              </div>

              <!-- Confirm Password -->
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="confirm-password" class="form-label">Confirm Password*</label>
                  <input type="password" class="form-control" id="confirm-password" name="confirm_password" required>
                  <div class="invalid-feedback">Please confirm your password.</div>
                </div>
              </div>
            </div>


            <div class="modal-footer">
              <button type="button" class="btn btn-link" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>




<!-- Models -->

  <!--  Employee Modal -->
  <div id="-employee-model" class="modal fade" tabindex="-1" aria-labelledby="EmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-full">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="EmployeeModalLabel"> Employee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
            <div class="form-section mb-4">
              <h4 class="mb-3">Employee Information</h4>
              <div class="row">
                <!-- Employee Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="employee_name" class="form-label">Employee Name*</label>
                    <input type="text" class="form-control" id="employee_name" name="employee_name" minlength="4"
                      maxlength="20" required>
                    <small class="form-text text-muted">Enter the full name as per official documents.</small>
                    <div class="invalid-feedback">Name is required and must be between 4 to 20 characters.</div>
                  </div>
                </div>
                <!-- Date of Birth -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth*</label>
                    <input type="date" class="form-control" id="dob" name="dob" required>
                    <small class="form-text text-muted">Select the date of birth from the calendar.</small>
                    <div class="invalid-feedback">Date of birth is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Date of Joining -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="doj" class="form-label">Date of Joining*</label>
                    <input type="date" class="form-control" id="doj" name="doj" required>
                    <small class="form-text text-muted">Date when the employee joined the company.</small>
                    <div class="invalid-feedback">Date of joining is required.</div>
                  </div>
                </div>
                <!-- Designation -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="designation" class="form-label">Designation*</label>
                    <input type="text" class="form-control" id="designation" name="designation" required>
                    <small class="form-text text-muted">Enter the employee's current job title.</small>
                    <div class="invalid-feedback">Designation is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Gender -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="gender" class="form-label">Gender*</label>
                    <select class="form-control" id="gender" name="gender" required>
                      <option value="" disabled selected>Select your gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="non-binary">Non-binary</option>
                      <option value="prefer-not-to-say">Prefer not to say</option>
                      <option value="other">Other</option>
                    </select>
                    <small class="form-text text-muted">Specify the gender as per official records.</small>
                    <div class="invalid-feedback">Gender is required.</div>
                  </div>
                </div>
                <!-- Email -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="email" class="form-label">Email*</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                    <small class="form-text text-muted">Enter a valid email address for communication.</small>
                    <div class="invalid-feedback">Valid email is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Primary Mobile Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="primary_mobile" class="form-label">Primary Mobile Number*</label>
                    <input type="tel" class="form-control" id="primary_mobile" name="primary_mobile" required>
                    <small class="form-text text-muted">Provide a contact number that is frequently used.</small>
                    <div class="invalid-feedback">Primary mobile number is required.</div>
                  </div>
                </div>
                <!-- Aadhar Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="aadhar_number" class="form-label">Aadhar Number*</label>
                    <input type="text" class="form-control" id="aadhar_number" name="aadhar_number" required>
                    <small class="form-text text-muted">Enter the 12-digit Aadhar number issued by the Indian
                      government.</small>
                    <div class="invalid-feedback">Aadhar number is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- PAN Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="pan_number" class="form-label">PAN Number*</label>
                    <input type="text" class="form-control" id="pan_number" name="pan_number" required>
                    <small class="form-text text-muted">Provide the Permanent Account Number for tax purposes.</small>
                    <div class="invalid-feedback">PAN number is required.</div>
                  </div>
                </div>
                <!-- Address -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="address" class="form-label">Address*</label>
                    <input type="text" class="form-control" id="address" name="address" required>
                    <small class="form-text text-muted">Enter the current residential address.</small>
                    <div class="invalid-feedback">Address is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Bank Account Number -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="bank_account" class="form-label">Bank Account Number*</label>
                    <input type="text" class="form-control" id="bank_account" name="bank_account" required>
                    <small class="form-text text-muted">Bank account number where salary is cred.</small>
                    <div class="invalid-feedback">Bank account number is required.</div>
                  </div>
                </div>
                <!-- Bank Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="bank_name" class="form-label">Bank Name*</label>
                    <input type="text" class="form-control" id="bank_name" name="bank_name" required>
                    <small class="form-text text-muted">Name of the bank where the account is held.</small>
                    <div class="invalid-feedback">Bank name is required.</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- IFSC Code -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="ifsc_code" class="form-label">IFSC Code*</label>
                    <input type="text" class="form-control" id="ifsc_code" name="ifsc_code" required>
                    <small class="form-text text-muted">Indian Financial System Code for electronic fund
                      transfers.</small>
                    <div class="invalid-feedback">IFSC code is required.</div>
                  </div>
                </div>
                <!-- Date of Leaving -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="date_of_leaving" class="form-label">Date of Leaving</label>
                    <input type="date" class="form-control" id="date_of_leaving" name="date_of_leaving">
                    <small class="form-text text-muted">Date on which the employee leaves the company (if
                      applicable).</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Father's Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="father_name" class="form-label">Father's Name</label>
                    <input type="text" class="form-control" id="father_name" name="father_name">
                    <small class="form-text text-muted">Name of the employee's father.</small>
                  </div>
                </div>
                <!-- Mother's Name -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="mother_name" class="form-label">Mother's Name</label>
                    <input type="text" class="form-control" id="mother_name" name="mother_name">
                    <small class="form-text text-muted">Name of the employee's mother.</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Password -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="employee_password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="employee_password" name="employee_password">
                    <small class="form-text text-muted">Your password must be at least 8 characters long.</small>
                  </div>
                </div>
                <!-- Confirm Password -->
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="confirm_password" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirm_password" name="confirm_password">
                    <small class="form-text text-muted">Please make sure your passwords match.</small>
                    <div class="error-message text-danger" id="error_message" style="display:none;">Passwords do not
                      match!</div>
                  </div>
                </div>
              </div>
            </div>
                
            <ul id="errorMessages" class="error-list"></ul>

            <div class="modal-footer">
              <button type="button" class="btn btn-link" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete the Employee: <strong id="deleteEmployeeName"></strong> ?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>


<!-- Toast Notification -->
<div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 1055;">
  <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Employee deleted successfully!
      </div>
      <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>


  

  <script>


    // employees table
    renderTable({
      tableClassName: '.datatable-nested', apiURl: '/api/employees', columns: [
        { data: "employeeName" },
        { data: "designation" },
        { data: "primaryMobileNumber" },
        { data: "emailId" },
        { data: "gender" },
        { data: "dateOfBirth" },
        { data: "bloodGroup" },
        { data: "address" },
        { data: "fatherName" },
        { data: "motherName" },
        { data: "bankName" },
        { data: "bankAccountNumber" },
        { data: "ifscCode" },
        { data: "aadharNumber" },
        { data: "panNumber" },
        { data: "dateOfJoining" },
        { data: "dateOfLeaving" },
        { data: "reference" },
        { data: "referenceContactNumber" },
        { data: "role" },
        { data: "password" },
        {
          data: null,
          className: "text-center",
          render: function (data, type, row) {
            return `
            <button type="button" class="btn btn-primary btn-sm" 
                    onclick="setData('${row.empId}','${row.employeeName}')">
                <i class="ph ph-pencil"></i>
            </button>
            <button type="button" class="btn btn-danger btn-sm ms-2" 
                    onclick="deleteData('${row.empId}','${row.employeeName}')">
                <i class="ph ph-trash"></i>
            </button>
        `;
          }
        }

      ]
    });

    function setData(id) {
      console.log("setData is running");

      // Retrieve and parse data
      const rawData = $("#data").text().trim();
      let parsedData;

      try {
        parsedData = JSON.parse(rawData);
      } catch (error) {
        console.error("Error parsing JSON data:", error);
        return;
      }

      console.log("Parsed data:", parsedData);

      // Find the employee by empId
      const employee = parsedData.find(item => item.empId === id);

      if (!employee) {
        console.error(`Employee with ID ${id} not found`);
        return;
      }

      // Debug
      console.log("Employee data in script:", employee);

      // Create modal and form references
      const modalElement = document.getElementById('employee_model');
      const modal = new bootstrap.Modal(modalElement);
      const form = modalElement.querySelector('form');

      // Clear existing form data
      form.reset();

      // Set form action URL
      form.action = `/dashboard/employee//${id}`;

      // Populate form fields with employee data
      form.querySelector('#employee_name').value = employee.employeeName || '';
      form.querySelector('#dob').value = employee.dateOfBirth || '';
      form.querySelector('#doj').value = employee.dateOfJoining || '';
      form.querySelector('#designation').value = employee.designation || '';
      form.querySelector('#gender').value = employee.gender || '';
      form.querySelector('#email').value = employee.emailId || '';
      form.querySelector('#primary_mobile').value = employee.primaryMobileNumber || '';
      form.querySelector('#aadhar_number').value = employee.aadharNumber || '';
      form.querySelector('#pan_number').value = employee.panNumber || '';
      form.querySelector('#address').value = employee.address || '';
      form.querySelector('#bank_account').value = employee.bankAccountNumber || '';
      form.querySelector('#bank_name').value = employee.bankName || '';
      form.querySelector('#ifsc_code').value = employee.ifscCode || '';
      form.querySelector('#date_of_leaving').value = employee.dateOfLeaving || '';
      form.querySelector('#father_name').value = employee.fatherName || '';
      form.querySelector('#mother_name').value = employee.motherName || '';
      form.querySelector('#spouse_name').value = employee.spouseName || '';
      form.querySelector('#reference').value = employee.reference || '';
      form.querySelector('#reference_contact').value = employee.referenceContactNumber || '';
      form.querySelector('#father_mobile').value = employee.fatherMobileNumber || '';
      form.querySelector('#mother_mobile').value = employee.motherMobileNumber || '';
      form.querySelector('#spouse_mobile').value = employee.spouseMobileNumber || '';
      form.querySelector('#blood_group').value = employee.bloodGroup || '';
      form.querySelector('#role').value = employee.role || '';
      form.querySelector('#employee_password').value = employee.password || '';
      form.querySelector('#confirm_password').value = employee.password || '';


      // Optionally, show the modal after setting up the form
      modal.show();
    }

      
    // Main function to handle delete request
function deleteData(id, employeeName) {
    // Check if the ID is valid
    if (!id) {
        alert("Invalid ID for deletion.");
        return;
    }

    // Show confirmation modal with the employee name
    showDeleteConfirmationModal(employeeName, () => {
        // Once confirmed, proceed with the AJAX call
        $.ajax({
            url: `/api/employee/delete/${id}`, // URL includes the ID of the item to delete
            type: 'DELETE',
            success: function(response) {
                if (response.success) {
                    // Show the success toast with the employee name
                    showSuccessToast(`Employee "${employeeName}" deleted successfully!`);
                    
                    // Optionally, reload the page after success
                    setTimeout(function() {
                        location.reload();
                    }, 1500); // Delay to let the toast show before reloading
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error deleting data:', error);
                alert('Failed to delete data. Please try again.');
            }
        });
    });
}

  
// Function to show delete confirmation modal
function showDeleteConfirmationModal(employeeName, callback) {
    // Set the employee name inside the modal
    document.getElementById('deleteEmployeeName').textContent = employeeName;

    // Initialize the modal
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
    
    // Show the modal
    deleteModal.show();
    
    // Attach event listener for confirmation button
    document.getElementById('confirmDeleteBtn').onclick = function() {
        // Invoke the callback to delete the item
        callback();

        // Close the modal after delete is confirmed
        deleteModal.hide();
    };
}

// Function to show success toast
function showSuccessToast(message) {
    // Update the toast body with the custom message
    const toastBody = document.getElementById('successToast').querySelector('.toast-body');
    toastBody.textContent = message;

    // Initialize and show the toast
    const successToast = new bootstrap.Toast(document.getElementById('successToast'));
    successToast.show();
}


    
  </script>


<script>
  $(document).ready(function () {
      $('#add-employee-form').on('submit', function (e) {
          e.preventDefault(); // Prevent the default form submission
          console.log("AJAX system running");

          $.ajax({
              type: 'POST',
              url: '/api/employee/create', // Replace with your server URL
              data: $(this).serialize(), // Serialize form data
              success: function (response) {
                  if (response.success) {
                      // Create and show success alert
                      const alertDiv = $('<div class="alert alert-success" role="alert">')
                          .text('Employee added successfully!')
                          .appendTo('body'); // Append to the body or a specific container

                      // Optionally, remove the alert after a few seconds
                      setTimeout(() => {
                          alertDiv.fadeOut('slow', function() {
                              $(this).remove();
                          });
                      }, 3000);

                      // Reload the page (uncomment if desired)
                      // window.location.reload();
                  }
              },
              error: function (xhr) {
                  console.error("AJAX error:", xhr);
                  const response = xhr.responseJSON || {};
                  console.log("tttt",response)
                  displayErrors(response.error || ['An unexpected error occurred.']);
              }
          });
      });

      function displayErrors(error) {
          const errorList = $('#errorMessages');
          errorList.empty(); // Clear existing messages
          if (error.length > 0) {
              errors.forEach(function(error) {
                  const li = $('<li>').text(error);
                  errorList.append(li);
              });
          }
      }
  });
</script>

  
  <%- include('../../partials/footer') %>
<%- include('../../partials/header.ejs', { title: title }) %>

<div class="page-content">
  <!-- Main sidebar -->
  <%- include('../../partials/sidebar.ejs') %>
  <!-- /main sidebar -->

  <!-- Main content -->
  <div class="content-wrapper">
    <!-- Main navbar -->
    <%- include('../../component/dashboard/navbar.ejs') %>
    <!-- /main navbar -->

    <!-- Inner content -->
    <div class="content-inner">
   

      <!-- Content area -->
      <div class="content">
        <!-- Nested object data -->
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">All Area </h5>
                <!-- <button class="btn btn-light">Add Customer</button> -->
                <!-- Button to trigger modal -->
                <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#add-area-model">Add Area<i class="ph ph-navigation-arrow ms-2"></i></button>
            </div>
           
            
          </div>

       
          <!-- Hidden element to pass JSON data to the JavaScript file -->
          <script type="application/json" id="data"> <%- JSON.stringify({ data: data, label: "areas" }) %> </script>
        
          
          
          
        
            <table class="table datatable-nested ">
              <thead>
                <tr>
                  <th>Area</th>
                  <th>District</th>
				  <th>Zone</th>
                  <th>State</th>
                  <th>Action</th>
                </tr>
              </thead>
			  <tbody>
				<!-- Data will be dynamically injected here -->
			  </tbody>
            </table>
        
        </div>
        <!-- /nested object data -->

        
      </div>
      <!-- /content area -->
    </div>
    <!-- /inner content -->
  </div>
  <!-- /main content -->
</div>
<!-- /page content -->



<!-- add area model -->
<div id="add-area-model" class="modal fade" tabindex="-1" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-full"></div>
  <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">EditArea</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
          <form action="/dashboard/area/create" method="POST" enctype="">
              <!-- Area Information -->
              <div class="form-section mb-4">
                  <h4 class="mb-3">Area Information</h4>
                  <div class="row">
                         <!-- Area Name -->
                         <div class="col-md-6">
                          <div class="mb-3">
                              <label for="area_name" class="form-label">Area*</label>
                              <input type="text" id="area_name" class="form-control"  name="area_name" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the area name as per official documents.</small>
                              
                          </div>
                      </div>

                      <!-- District Name -->
                      <div class="col-md-6">
                          <div class="mb-3">
                              <label for="district" class="form-label">District*</label>
                              <input type="text" class="form-control" id="district" name="district" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the District as per official documents.</small>
                              
                          </div>
                      </div>
                     
                  </div>
          
                  <div class="row">
                      <!-- zone -->
                      <div class="col-md-6">
                        <div class="mb-3">
                            <label for="zone" class="form-label">Zone</label>
                            <input type="text" class="form-control" id="zone" name="zone" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                            <small class="form-text text-muted">Enter the Zone as per official documents.</small>
                        </div>
                      </div>
                         <!-- State/UT* -->
                         <div class="col-md-6">
                          <div class="mb-3">
                              <label for="state" class="form-label">State/UT*</label>
                              <select class="form-control" id="state" name="state" required value="">
                                  <option value="" disabled selected>Select your state/UT</option>
                                  <!-- Indian States -->
                                  <option value="Andhra Pradesh">Andhra Pradesh</option>
                                  <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                  <option value="Assam">Assam</option>
                                  <option value="Bihar">Bihar</option>
                                  <option value="Chhattisgarh">Chhattisgarh</option>
                                  <option value="Goa">Goa</option>
                                  <option value="Gujarat">Gujarat</option>
                                  <option value="Haryana">Haryana</option>
                                  <option value="Himachal Pradesh">Himachal Pradesh</option>
                                  <option value="Jharkhand">Jharkhand</option>
                                  <option value="Karnataka">Karnataka</option>
                                  <option value="Kerala">Kerala</option>
                                  <option value="Madhya Pradesh">Madhya Pradesh</option>
                                  <option value="Maharashtra">Maharashtra</option>
                                  <option value="Manipur">Manipur</option>
                                  <option value="Meghalaya">Meghalaya</option>
                                  <option value="Mizoram">Mizoram</option>
                                  <option value="Nagaland">Nagaland</option>
                                  <option value="Odisha">Odisha</option>
                                  <option value="Punjab">Punjab</option>
                                  <option value="Rajasthan">Rajasthan</option>
                                  <option value="Sikkim">Sikkim</option>
                                  <option value="Tamil Nadu">Tamil Nadu</option>
                                  <option value="Telangana">Telangana</option>
                                  <option value="Tripura">Tripura</option>
                                  <option value="Uttar Pradesh">Uttar Pradesh</option>
                                  <option value="Uttarakhand">Uttarakhand</option>
                                  <option value="West Bengal">West Bengal</option>
                                  <!-- Union Territories -->
                                  <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                  <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                  <option value="Lakshadweep">Lakshadweep</option>
                                  <option value="Delhi">Delhi</option>
                                  <option value="Puducherry">Puducherry</option>
                                  <option value="Ladakh">Ladakh</option>
                                  <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                              </select>
                              <small class="form-text text-muted">Please select your state or union territory.</small>
                          </div>
                      </div>
                      
                  </div>
          
    
              </div>
          
              <div class="modal-footer">
                  <button type="button" class="btn btn-link" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save</button>
              </div>
          </form>
          
          
  </div>
  </div>
</div>

<!-- edit area model -->
<div id="edit-area-model" class="modal fade" tabindex="-1" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-full"></div>
  <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">EditArea</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
          <form action="" method="POST" enctype="">
              <!-- Area Information -->
              <div class="form-section mb-4">
                  <h4 class="mb-3">Area Information</h4>
                  <div class="row">
                         <!-- Area Name -->
                         <div class="col-md-6">
                          <div class="mb-3">
                              <label for="area_name" class="form-label">Area*</label>
                              <input type="text" id="area_name" class="form-control"   name="area_name" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the area name as per official documents.</small>
                              
                          </div>
                      </div>

                      <!-- District Name -->
                      <div class="col-md-6">
                          <div class="mb-3">
                              <label for="district" class="form-label">District*</label>
                              <input type="text" class="form-control" id="district" name="district" minlength="4" maxlength="20" required pattern="[A-Za-z\s'-]+" value="">
                              <small class="form-text text-muted">Enter the District as per official documents.</small>
                              
                          </div>
                      </div>
                     
                  </div>
          
                  <div class="row">
                      <!-- zone -->
                      <div class="col-md-6">
                        <div class="mb-3">
                            <label for="zone" class="form-label">Zone</label>
                            <input type="text" class="form-control" id="zone" name="zone" minlength="4" maxlength="20"  pattern="[A-Za-z\s'-]+" value="">
                            <small class="form-text text-muted">Enter the Zone as per official documents.</small>
                        </div>
                      </div>
                         <!-- State/UT* -->
                         <div class="col-md-6">
                          <div class="mb-3">
                              <label for="state" class="form-label">State/UT*</label>
                              <select class="form-control" id="state" name="state" required value="">
                                  <option value="" disabled selected>Select your state/UT</option>
                                  <!-- Indian States -->
                                  <option value="Andhra Pradesh">Andhra Pradesh</option>
                                  <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                  <option value="Assam">Assam</option>
                                  <option value="Bihar">Bihar</option>
                                  <option value="Chhattisgarh">Chhattisgarh</option>
                                  <option value="Goa">Goa</option>
                                  <option value="Gujarat">Gujarat</option>
                                  <option value="Haryana">Haryana</option>
                                  <option value="Himachal Pradesh">Himachal Pradesh</option>
                                  <option value="Jharkhand">Jharkhand</option>
                                  <option value="Karnataka">Karnataka</option>
                                  <option value="Kerala">Kerala</option>
                                  <option value="Madhya Pradesh">Madhya Pradesh</option>
                                  <option value="Maharashtra">Maharashtra</option>
                                  <option value="Manipur">Manipur</option>
                                  <option value="Meghalaya">Meghalaya</option>
                                  <option value="Mizoram">Mizoram</option>
                                  <option value="Nagaland">Nagaland</option>
                                  <option value="Odisha">Odisha</option>
                                  <option value="Punjab">Punjab</option>
                                  <option value="Rajasthan">Rajasthan</option>
                                  <option value="Sikkim">Sikkim</option>
                                  <option value="Tamil Nadu">Tamil Nadu</option>
                                  <option value="Telangana">Telangana</option>
                                  <option value="Tripura">Tripura</option>
                                  <option value="Uttar Pradesh">Uttar Pradesh</option>
                                  <option value="Uttarakhand">Uttarakhand</option>
                                  <option value="West Bengal">West Bengal</option>
                                  <!-- Union Territories -->
                                  <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                  <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                  <option value="Lakshadweep">Lakshadweep</option>
                                  <option value="Delhi">Delhi</option>
                                  <option value="Puducherry">Puducherry</option>
                                  <option value="Ladakh">Ladakh</option>
                                  <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                              </select>
                              <small class="form-text text-muted">Please select your state or union territory.</small>
                          </div>
                      </div>
                      
                  </div>
          
    
              </div>
          
              <div class="modal-footer">
                  <button type="button" class="btn btn-link" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save</button>
              </div>
          </form>
          
          
  </div>
  </div>
</div>


<!-- confirm delete model -->
<div class="modal fade" id="confirm" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this item?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>


<script>

 let deletedAreaID = null;

  function setEditAreaData(areaId) {

    // debug
    console.log("areaID-setEditAreaData-f", typeof areaId)
    try {
      // Retrieve and parse data
      const rawData = $("#data").text().trim();
      let parsedData = JSON.parse(rawData);
      const { data } = parsedData;

      // Find the area by areaId
      const area = data.find(item => item.areaId === Number(areaId));

      if (!area) {
        console.error(`Employee with ID ${areaId} not found`);
        return;
      }

      console.log("Show data with ID:", areaId);
      console.log("Employee data in script:", area);

      // Create modal and form references
      const modal = new bootstrap.Modal(document.getElementById('edit-area-model'));
      const form = document.querySelector('#edit-area-model form');

      // Set form action URL
      const actionUrl = `/dashboard/area/update/edit/${areaId}`;
      form.action = actionUrl;


      // Populate form fields
      form.querySelector('#area_name').value = area.area || '';
      form.querySelector('#district').value = area.district || '';
      form.querySelector('#zone').value = area.zone || '';
      form.querySelector('#state').value = area.state || '';
   
      
      // Handle photo preview (if applicable)
      // Uncomment if you have a way to show the existing photo
      // const photoPreview = document.querySelector('#photo-preview');
      // if (employee.photo) {
      //     photoPreview.src = employee.photo; // Set this to the URL of the photo
      // } else {
      //     photoPreview.src = ''; // Hide or clear the preview
      // }

      // Show the modal
      modal.show();

    } catch (error) {
      console.error("Error handling edit data:", error);
    }
  }

  // Function to handle delete data
  function setDeleteAreaData(areaId) {
    deletedAreaID=Number(areaId);
    try {
      // Retrieve and parse data
      const rawData = $("#data").text().trim();
      let parsedData = JSON.parse(rawData);
      const { data } = parsedData;

      // Find the employee by areaId
      const area = data.find(item => item.areaId === Number(areaId));

      if (!area) {
        console.error(`Employee with ID ${areaId} not found`);
        return;
      }

      console.log("Show data with ID:", area);
      console.log("Employee data in script:", area);

      // Create modal and form references
      const modal = new bootstrap.Modal(document.getElementById('confirm'));
      // const form = document.querySelector('#edit-employee-model form');

      // // Set form action URL
      // const actionUrl = `/dashboard/employees/edit/${empId}`;
      // form.action = actionUrl;



      // Show the modal
      modal.show();

    } catch (error) {
      console.error("Error handling delete data:", error);
    }
  };
  
  async function confirmDelete() {
// Check if the deletedAreaID is valid
if (deletedAreaID !== null && deletedAreaID !== undefined) {
  try {
    const response = await fetch(`/dashboard/area/delete/${deletedAreaID}`, {
      method: 'DELETE',
    });

    // Close the Bootstrap modal before alerting or refreshing the page
    const modalElement = document.getElementById('confirm');
    const modalInstance = bootstrap.Modal.getInstance(modalElement);
    modalInstance.hide();

    // const data = await response.json();

    if (response.ok) {
      alert('Record deleted successfully!');
      location.reload(); // Optionally, refresh the page to reflect changes
    } else {
      alert('Error deleting record.');
    }
  } catch (error) {
    console.error('Error:', error);
  }
} else {
  console.error('No area ID provided for deletion.');
}
}

</script>
<%- include('../../partials/footer') %>